# Production HPA patch - overrides base autoscaling settings
# Configures how the application scales in production
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: api
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: api
  # Minimum number of pods to always keep running
  minReplicas: 5
  # Maximum number of pods that can be created
  maxReplicas: 20
  # Scaling behavior controls how quickly pods are added or removed
  behavior:
    # Scale down behavior - removes pods slowly to avoid over-reacting
    scaleDown:
      # Wait 5 minutes before scaling down to ensure traffic decrease is real
      stabilizationWindowSeconds: 300
      policies:
        - type: Pods
          value: 1
          periodSeconds: 60
    # Scale up behavior - adds pods quickly to handle traffic spikes
    scaleUp:
      # Wait only 30 seconds before scaling up to respond quickly
      stabilizationWindowSeconds: 30
      policies:
        - type: Pods
          value: 2
          periodSeconds: 60
